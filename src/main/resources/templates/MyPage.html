<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link id="theme-css" rel="stylesheet" th:href="@{/css/mypage.css}" />
   <script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // 저장된 모드 불러오기
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // 로그인 상태에서는 저장된 테마 적용
		    applyTheme(savedTheme);
		
		    // 버튼 클릭 시 다크모드 전환
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // 로그아웃 상태에서는 항상 라이트모드 적용
		    applyTheme("light");
		  }
		
		  // ✅ 테마 적용 함수
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/mypage.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/mypage.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
		      }
		    }
		  }
		});
	</script>

    <link rel="stylesheet" th:href="@{/css/footer.css}" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
    <!-- 헤더 -->
    <div th:replace="~{fragments/header :: siteHeader}"></div>

    <div class="location-container">
        <div class="mypage-container">
            <div class="title">
                마이페이지
                <button class="info-edit-button" id="editButton">
                    <img th:src="@{/images/write.svg}"/>수정하기
                </button>
            </div>

            <!-- 프로필 이미지 -->
            <div class="profile-image-location-container">
                <img th:src="${user.profileImage != null ? user.profileImage : '/images/default-profile.png'}"
                     alt="프로필 이미지" class="profile-image-container"/>
            </div>

            <!-- 사용자 별명 -->
            <div class="user-name" th:text="${user.nickname != null ? user.nickname : '닉네임 없음'}">사용자 이름</div>

            <!-- 사용자 정보 -->
            <div class="user-info-container">
                <div class="email-address">이메일</div>
                <div class="user-email-address" th:text="${user.email != null ? user.email : ''}">이메일 주소</div>

                <div class="id">아이디</div>
                <div class="user-id" th:text="${user.userId != null ? user.userId : ''}">아이디 값</div>

             	 <div class="bio">자기소개</div>
	             <div class="user-bio" id="bio" name="bio" th:text="${user?.bio !=null ? user.bio : '없음'}">자기소개</div>

                <div class="social-login">소셜 로그인 여부</div>
                <div class="user-social-login" th:text="${user.socialLogin != null ? user.socialLogin : '없음'}">소셜 로그인 여부</div>

                <div class="interesting">관심 분야</div>
                <div class="user-interesting" th:text="${user.interestArea != null ? user.interestArea : '관심 분야 없음'}">관심 분야</div>
            </div>
        </div>
        <div class="path-container">
        	<div class="path-location-container">
        		<div class="path-title">SAEGIM.PATH</div>
        		<div class="path-progress-level">패스레벨</div>
        		<div class="path-progress-bar">
        			<div class="circular-progress" data-percent="75">
    					<span class="progress-value">75%</span>
					</div>
        		</div>
        		<div class="path-reward-container">
        			<div class="reward-title">보상목록</div>
        			<div class="reward-info-container">        			
	        			<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		   		        <div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		
		        	    <div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		
        			</div>
        		</div>
        	</div>
        </div>
    </div>

    <!-- JS 블록: editMypage URL로 안전하게 이동 -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        var editButton = document.getElementById('editButton');
        if(editButton){
            editButton.addEventListener('click', function(){
                // Spring Security, Controller에 맞게 /editMypage로 이동
                location.href = /*[[@{/editMypage}]]*/ '/editMypage';
            });
        }
        /*]]>*/
    </script>
	<script>
		let progressStartValue = 0;
		let progressEndValue = 75; // 원하는 진척도 퍼센트
		let speed = 20; // 애니메이션 속도
	
		let progress = setInterval(() => {
		    progressStartValue++;
		    let angle = progressStartValue * 3.6; // 360도 / 100% = 3.6도/퍼센트
	
		    document.querySelector(".progress-value").textContent = `${progressStartValue}%`;
		    document.querySelector(".circular-progress").style.background = 
		        `conic-gradient(#389DEF ${angle}deg, #ededed 0deg)`;
	
		    if(progressStartValue == progressEndValue){
		        clearInterval(progress);
		    }
		}, speed);
	</script>
	<script>
	    const rewardInfoContainer = document.querySelector('.reward-info-container');
	
	    if (rewardInfoContainer) {
	        rewardInfoContainer.addEventListener('wheel', function(e) {
	            e.preventDefault(); // 기본 세로 스크롤 막기
	            rewardInfoContainer.scrollLeft += e.deltaY; // 세로 휠 값으로 가로 이동
	        });
	    }
	</script>

    <div th:replace="~{fragments/footer :: siteFooter}"></div>
</body>
</html>
