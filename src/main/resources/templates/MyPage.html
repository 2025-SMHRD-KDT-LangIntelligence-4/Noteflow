<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´í˜ì´ì§€</title>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link id="theme-css" rel="stylesheet" th:href="@{/css/mypage.css}" />
<script>
document.addEventListener("DOMContentLoaded", () => {
  const themeLink = document.getElementById("theme-css");
  const themeToggleBtn = document.getElementById("theme-toggle-btn");

  // ì €ì¥ëœ ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
  const savedTheme = localStorage.getItem("theme") || "light";

  // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ (ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ íŒë‹¨)
  const isLoggedIn = !!themeToggleBtn;

  if (isLoggedIn) {
    // ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ì €ì¥ëœ í…Œë§ˆ ì ìš©
    applyTheme(savedTheme);

    // ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤í¬ëª¨ë“œ ì „í™˜
    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
    });
  } else {
    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” í•­ìƒ ë¼ì´íŠ¸ëª¨ë“œ ì ìš©
    applyTheme("light");
  }

  function applyTheme(mode) {
    if (mode === "dark") {
      themeLink.setAttribute("href", "/CSSDARK/mypage.css");
      localStorage.setItem("theme", "dark");
      if (themeToggleBtn) themeToggleBtn.textContent = "â˜€ï¸";
    } else {
      themeLink.setAttribute("href", "/css/mypage.css");
      localStorage.setItem("theme", "light");
      if (themeToggleBtn) themeToggleBtn.textContent = "ğŸŒ™";
    }
  }
});
</script>

    <link rel="stylesheet" th:href="@{/css/footer.css}" />
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
    <!-- í—¤ë” -->
    <div th:replace="~{fragments/header :: siteHeader}"></div>

    <div class="location-container">
        <div class="mypage-container">
            <div class="title">
                ë§ˆì´í˜ì´ì§€
                <button class="info-edit-button" id="editButton">
                    <img th:src="@{/images/write.svg}"/>ìˆ˜ì •í•˜ê¸°
                </button>
            </div>

            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
            <div class="profile-image-location-container">
                <img th:src="${user.profileImage != null ? user.profileImage : '/images/default-profile.png'}"
                     alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image-container"/>
            </div>

            <!-- ì‚¬ìš©ì ë³„ëª… -->
            <div class="user-name" th:text="${user.nickname != null ? user.nickname : 'ë‹‰ë„¤ì„ ì—†ìŒ'}">ì‚¬ìš©ì ì´ë¦„</div>

            <!-- ì‚¬ìš©ì ì •ë³´ -->
            <div class="user-info-container">
                <div class="email-address">ì´ë©”ì¼</div>
                <div class="user-email-address" th:text="${user.email != null ? user.email : ''}">ì´ë©”ì¼ ì£¼ì†Œ</div>

                <div class="id">ì•„ì´ë””</div>
                <div class="user-id" th:text="${user.userId != null ? user.userId : ''}">ì•„ì´ë”” ê°’</div>

             	 <div class="bio">ìê¸°ì†Œê°œ</div>
	             <div class="user-bio" id="bio" name="bio" th:text="${user?.bio !=null ? user.bio : 'ì—†ìŒ'}">ìê¸°ì†Œê°œ</div>

                <div class="social-login">ì†Œì…œ ë¡œê·¸ì¸ ì—¬ë¶€</div>
                <div class="user-social-login" th:text="${user.socialLogin != null ? user.socialLogin : 'ì—†ìŒ'}">ì†Œì…œ ë¡œê·¸ì¸ ì—¬ë¶€</div>

                <div class="interesting">ê´€ì‹¬ ë¶„ì•¼</div>
                <div class="user-interesting" th:text="${user.interestArea != null ? user.interestArea : 'ê´€ì‹¬ ë¶„ì•¼ ì—†ìŒ'}">ê´€ì‹¬ ë¶„ì•¼</div>
            </div>
        </div>
        <div class="path-container">
        	<div class="path-location-container">
        		<div class="path-title">SAEGIM.PATH</div>
        		<div class="path-progress-level">íŒ¨ìŠ¤ë ˆë²¨</div>
        		<div class="path-progress-bar">
        			<div class="circular-progress" data-percent="75">
    					<span class="progress-value">75%</span>
					</div>
        		</div>
        		<div class="path-reward-container">
        			<div class="reward-title">ë³´ìƒëª©ë¡</div>
        			<div class="reward-info-container">        			
	        			<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		<div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		   		        <div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		
		        	    <div class="path-reward-list">
							<div class="reward-img"></div>	        			
		        			<div class="reward-name"></div>
	        			</div>
		        		<img class="next-sign" th:src="@{/images/arrowVector.svg}"/>
		        		
        			</div>
        		</div>
        	</div>
        </div>
    </div>

    <!-- JS ë¸”ë¡: editMypage URLë¡œ ì•ˆì „í•˜ê²Œ ì´ë™ -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        var editButton = document.getElementById('editButton');
        if(editButton){
            editButton.addEventListener('click', function(){
                // Spring Security, Controllerì— ë§ê²Œ /editMypageë¡œ ì´ë™
                location.href = /*[[@{/editMypage}]]*/ '/editMypage';
            });
        }
        /*]]>*/
    </script>
	<script>
		let progressStartValue = 0;
		let progressEndValue = 75; // ì›í•˜ëŠ” ì§„ì²™ë„ í¼ì„¼íŠ¸
		let speed = 20; // ì• ë‹ˆë©”ì´ì…˜ ì†ë„
	
		let progress = setInterval(() => {
		    progressStartValue++;
		    let angle = progressStartValue * 3.6; // 360ë„ / 100% = 3.6ë„/í¼ì„¼íŠ¸
	
		    document.querySelector(".progress-value").textContent = `${progressStartValue}%`;
		    document.querySelector(".circular-progress").style.background = 
		        `conic-gradient(#389DEF ${angle}deg, #ededed 0deg)`;
	
		    if(progressStartValue == progressEndValue){
		        clearInterval(progress);
		    }
		}, speed);
	</script>
	<script>
	    const rewardInfoContainer = document.querySelector('.reward-info-container');
	
	    if (rewardInfoContainer) {
	        rewardInfoContainer.addEventListener('wheel', function(e) {
	            e.preventDefault(); // ê¸°ë³¸ ì„¸ë¡œ ìŠ¤í¬ë¡¤ ë§‰ê¸°
	            rewardInfoContainer.scrollLeft += e.deltaY; // ì„¸ë¡œ íœ  ê°’ìœ¼ë¡œ ê°€ë¡œ ì´ë™
	        });
	    }
	</script>

    <div th:replace="~{fragments/footer :: siteFooter}"></div>
</body>
</html>
