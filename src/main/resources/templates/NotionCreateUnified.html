<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title th:text="${pageTitle} ?: '노션 작성'">노션 작성</title>
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link rel="stylesheet" id="theme-css"th:href="@{/css/NotionCreateUnified.css}" />
<link rel="stylesheet" th:href="@{/css/footer.css}" />
<script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // 저장된 모드 불러오기
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // 로그인 상태에서는 저장된 테마 적용
		    applyTheme(savedTheme);
		
		    // 버튼 클릭 시 다크모드 전환
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // 로그아웃 상태에서는 항상 라이트모드 적용
		    applyTheme("light");
		  }
		
		  // ✅ 테마 적용 함수
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/NotionCreateUnified.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/NotionCreateUnified.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
		      }
		    }
		  }
		});
	</script> 

  <!-- CSRF -->
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <!-- Toast UI Editor / Viewer -->

<link rel="stylesheet"
	href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />

<script
	src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>

</head>
<body>
  <!-- ✅ 헤더 프래그먼트 포함 (실제 fragment 이름에 맞게 조정) -->
  <div th:replace="fragments/header :: siteHeader"></div>

  <div class="nc-container">
    <!-- 🔄 [선택 단계] 프롬프트 슬라이드 + 예시 Viewer -->
    <section id="nc-promptStage">
      <div class="nc-slider-wrapper" style="margin-bottom:12px;">
        <div class="nc-slide-container">
          <div id="nc-buttonContainer"></div>
          <button class="nc-arrow nc-left" aria-label="이전">‹</button>
          <button class="nc-arrow nc-right" aria-label="다음">›</button>
        </div>
      </div>
	  <div class="version-btn-container">
	  	<button class="simpleBtn">심플</button>
	  	<button class="normalBtn">표준</button>
	  	<button class="advanceBtn">고급</button>
	  </div>
      <div class="nc-prompt-example-viewer">
        <div class="nc-viewer-header">
          <label class="nc-viewer-title">프롬프트 예시</label>
          <span class="nc-badge nc-badge-readonly">예시는 편집 불가</span>
        </div>
        <div id="nc-promptExampleViewer" class="nc-viewer-surface" aria-label="프롬프트 예시 읽기 전용"></div>
        <p class="nc-desc">
          <b>현재:</b> 프롬프트가 여기에 표시됩니다. 카드의 체크박스를 켜면 선택 프롬프트의 예시만 표시되고 슬라이드가 멈춥니다.
        </p>
      </div>
    </section>

    <!-- ✍️ [입력 단계] 프롬프트 확정 후 — 슬라이드/Viewer 숨김, 상단에 ‘돌아가기’ -->
    <section id="nc-inputStage" style="display:none;">
	      <div class="nc-stage-header">
	        <div id="nc-selectedPromptName" class="nc-selected-name">선택한 프롬프트: (없음)</div>
	        <button id="nc-btnBack" class="nc-btn nc-btn-back">← 프롬프트 선택으로 돌아가기</button>
	      </div>

	      <!-- 제목 -->
	      <div style="margin-bottom:8px; width:90%; display:flex; justify-content:space-between; align-items:center;">
	        <label for="nc-ResultTitle" style="width: 40px;">제목</label>
	        <input id="nc-ResultTitle" type="text" class="title" placeholder="제목을 입력하세요"/>
	      </div>

	      <!-- 작성용 Toast Editor -->
	      <div class="nc-text-input">
	        <label>입력/편집</label>
	        <div id="nc-editor"></div>
	        <div class="nc-counters">
	          <span>글자수: <b id="nc-charCount">0</b></span>
	          <span>토큰(추정): <b id="nc-tokenCount">0</b></span>
	          <span id="nc-lengthHint" class="nc-hint"></span>
	        </div>
	      </div>

	      <!-- 파일 업로드 -->
		<div class="nc-file-section">
			<label>또는 파일 업로드</label>
			<input type="file" id="nc-fileInput" style="display:none;">
			<button id="nc-file-upload" class="nc-btn nc-secondary">📁 파일 선택 및 업로드</button>
			<p id="nc-preMsg"></p>
		</div>

	      <!-- 액션 -->
	      <div class="nc-actions">
	        <label>요약하기 미실행후 저장시 입력내용만 저장됩니다.</label>
	        <div class="nc-btn-container">
		        <button id="nc-temsetBtn" class="nc-btn nc-primary" disabled>요약하기</button>
		        <button id="nc-saveBtn" class="nc-btn nc-secondary" disabled>저장하기</button>
	        </div>
	      </div>

	      <!-- 결과 -->
	      <label class="subs-title">요약결과</label>
	      <div id="nc-resultBox" class="nc-result-box"></div>
    </section>

    <!-- 로딩 오버레이 -->
    <div id="nc-loadingOverlay">
    	
    	요약 중...
    </div>
  </div>

  <!-- ✅ 푸터 프래그먼트 포함 (실제 fragment 이름에 맞게 조정) -->
  <div th:replace="fragments/footer :: siteFooter"></div>

  <!-- 서버 프롬프트 목록 -->
	<script th:inline="javascript">
		window.prompts = /*[[${prompts}]]*/[];
	</script>
	<script th:src="@{/js/NotionCreateUnified.js}"></script>
</body>
</html>