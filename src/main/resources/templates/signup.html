<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원가입</title>
    <script>
        // [추가] 비밀번호 확인 체크
        function validateForm() {
            const pw = document.getElementById("userPw").value;
            const confirmPw = document.getElementById("confirmPw").value;
            if (pw !== confirmPw) {
                alert("비밀번호가 일치하지 않습니다.");
                return false; // 전송 중단
            }

            // [추가] 약관 동의 체크
            if (!document.getElementById("terms").checked) {
                alert("약관에 동의해야 가입할 수 있습니다.");
                return false;
            }
            return true;
        }
    </script>
</head>
<body>
<h2>회원가입</h2>

<!-- 아이디 중복 에러 메시지 -->
<div th:if="${param.error}" style="color:red">
    아이디가 이미 존재합니다. 다른 아이디를 사용해주세요.
</div>

<form th:action="@{/signup}" method="post" th:object="${user}" onsubmit="return validateForm()">
    <!-- 아이디 -->
    <label for="userId">아이디:</label>
    <input type="text" id="userId" th:field="*{userId}" required>
    <br>

    <!-- 비밀번호 -->
    <label for="userPw">비밀번호:</label>
    <input type="password" id="userPw" th:field="*{userPw}" required>
    <br>

    <!-- 비밀번호 확인 -->
    <label for="confirmPw">비밀번호 확인:</label>
    <input type="password" id="confirmPw" th:field="*{userPwConfirm}" required>
    <br>

    <!-- 이메일 -->
    <label for="email">이메일:</label>
    <input type="email" id="email" th:field="*{email}" required>
    <br>

    <!-- 메일 수신 동의 -->
    <label for="mailingAgreed">메일 수신 동의:</label>
    <input type="checkbox" id="mailingAgreed" th:field="*{mailingAgreed}">
    <br>

    <!-- 관심 분야 -->
    <label for="interestArea">관심 분야:</label>
    <input type="text" id="interestArea" th:field="*{interestArea}">
    <br>

    <!-- 학습 분야 -->
    <label for="learningArea">학습 분야:</label>
    <input type="text" id="learningArea" th:field="*{learningArea}">
    <br>

    <!-- 첨부파일 카운트 (기본 0) 
    <label for="attachmentCount">첨부파일 수:</label>
    <input type="number" id="attachmentCount" th:field="*{attachmentCount}" value="0">
    <br>-->

    <!-- [추가] 약관 동의 -->
    <label>
        <input type="checkbox" id="terms" required>
        서비스 이용약관에 동의합니다.
    </label>
    <br><br>

    <button type="submit">회원가입</button>
</form>

<a th:href="@{/login}">로그인으로 돌아가기</a>

<script>
        // jQuery AJAX 요청
        $(document).ready(function() {
            $("#checkBtn").click(function() {
                let userId = $("#userId").val();

                if(userId === "") {
                    $("#checkResult").css("color", "red").text("아이디를 입력하세요.");
                    return;
                }

                $.ajax({
                    url: "/checkId", // Controller와 매핑된 URL
                    type: "GET",
                    data: { userId: userId },
                    success: function(response) {
                        if(response === true) {
                            $("#checkResult").css("color", "red").text("이미 사용 중인 아이디입니다.");
                        } else {
                            $("#checkResult").css("color", "green").text("사용 가능한 아이디입니다.");
                        }
                    },
                    error: function() {
                        $("#checkResult").css("color", "red").text("서버 오류 발생!");
                    }
                });
            });
        });
    </script>
</body>
</html>
