<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link rel="stylesheet" th:href="@{/css/signUp.css}" />
<link rel="stylesheet" th:href="@{/css/footer.css}" />
<head>

    <meta charset="UTF-8">
    <title>회원가입</title>
    <script>
        // [추가] 비밀번호 확인 체크
        function validateForm() {
            const pw = document.getElementById("userPw").value;
            const confirmPw = document.getElementById("confirmPw").value;
            if (pw !== confirmPw) {
                alert("비밀번호가 일치하지 않습니다.");
                return false; // 전송 중단
            }

            // [추가] 약관 동의 체크
            if (!document.getElementById("terms").checked) {
                alert("약관에 동의해야 가입할 수 있습니다.");
                return false;
            }
            return true;
        }
    </script>
</head>
<body>
 <div th:replace="fragments/header :: siteHeader"></div>

<!-- 아이디 중복 에러 메시지 -->
<div th:if="${param.error}" style="color:red">
    아이디가 이미 존재합니다. 다른 아이디를 사용해주세요.
</div>
<div class="signup-location-container">
    <form th:action="@{/signup}" method="post" th:object="${user}" onsubmit="return validateForm()" class="signup-container">
		<h2>회원가입</h2>
        <label for="userId">아이디</label>
        <div class="id-check">
            <input type="text" id="userId" th:field="*{userId}" required>
            <button type="button" id="checkBtn">중복확인</button>
        </div>
        <div th:if="${param.error}" style="color:red; font-size:14px; margin-bottom:10px;">
           
        </div>
        <!-- 메시지 영역 -->
        <div id="checkResult"></div>

        <label for="userPw">비밀번호</label>
        <input type="password" id="userPw" th:field="*{userPw}" required>

        <label for="confirmPw">비밀번호 확인</label>
        <input type="password" id="confirmPw" required>

        <label for="email">이메일</label>
        <input type="email" id="email" th:field="*{email}" required>

        <label>
            <input type="checkbox" id="mailingAgreed" th:field="*{mailingAgreed}"> 메일 수신 동의
        </label>

        <label for="interestArea">관심 분야</label>
        <input type="text" id="interestArea" th:field="*{interestArea}">

        <label for="learningArea">학습 분야</label>
        <input type="text" id="learningArea" th:field="*{learningArea}">

        <label for="attachmentCount">첨부파일 수</label>
        <input type="number" id="attachmentCount" th:field="*{attachmentCount}" value="0">

        <label>
            <input type="checkbox" id="terms" required> 서비스 이용약관에 동의합니다.
        </label>

       <button type="submit">회원가입</button>
	    <div class="link">
	        <a href="/login">로그인으로 돌아가기</a>
	    </div>
    </form>

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $("#checkBtn").click(function() {
            let userId = $("#userId").val();

            if(userId === "") {
                $("#checkResult").attr("class","error-message").text("아이디를 입력하세요.");
                return;
            }

            $.ajax({
                url: "/checkId",
                type: "GET",
                data: { userId: userId },
                success: function(response) {
                    if(response === true) {
                        $("#checkResult").attr("class","error-message")
                            .text("아이디가 이미 존재합니다. 다른 아이디를 사용해주세요.");
                    } else {
                        $("#checkResult").attr("class","success-message")
                            .text("사용 가능한 아이디입니다.");
                    }
                },
                error: function() {
                    $("#checkResult").attr("class","error-message").text("서버 오류 발생");
                }
            });
        });
    });
</script>
<div th:replace="fragments/footer :: siteFooter"></div>
</body>
</html>
