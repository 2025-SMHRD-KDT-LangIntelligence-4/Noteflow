<!-- src/main/resources/templates/fragments/header.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="UTF-8">
<head>
    <!-- 외부 CSS 파일 연결 -->
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    
</head>
<body>
<header th:fragment="siteHeader">
	<div class="header-wrapper">
	    <div class="header-top">
	    	<div class ="header-top-right">
		        <a th:href="@{/main}" class="logo"><img th:src="@{/images/logo2.png}" class="logo-image"/></a>
		        <!-- 카테고리 메뉴 -->
		        <div class="categori-container">
		            <a th:href="@{/main}" th:classappend="${activeMenu == 'main'} ? ' active' : ''">메인화면</a>
		            <a th:href="@{/notion/precreate}" th:classappend="${activeMenu == 'notionCreate'} ? ' active' : ''">노션작성</a>
		            <a th:href="@{/notion/manage}" th:classappend="${activeMenu == 'notionManage'} ? ' active' : ''">노션관리</a>
		            <a th:href="@{/quiz/create}" th:classappend="${activeMenu == 'quizCreate'} ? ' active' : ''">문제생성</a>
		            <a th:href="@{/schedule}" th:classappend="${activeMenu == 'schedule'} ? ' active' : ''">일정관리</a>
		            <a th:href="@{/market}" th:classappend="${activeMenu == 'market'} ? active : ''">마켓이동</a>
		        </div>
		
	    	</div>
	        <!-- 로그인 상태에 따른 버튼 -->
	        <div class="login-container">
	            <div sec:authorize="isAnonymous()">
	                <a th:href="@{/login}" class="login-button">로그인</a>
	            </div>
	            <div sec:authorize="isAuthenticated()" class="login-button-location">
	            	<div class="out-user-name" th:text="${nickname} + '님 환영합니다.'">OOO님 환영합니다.</div>
	            	<div class="userProfile-container">
						  <button class="userProfile-btn" id="profileBtn">
						    <img th:src="@{/images/default-profile.png}" alt="프로필 이미지" class="user-image-container" />
						  </button>
	
						  <!-- ▼ 클릭 시 나타날 드롭다운 -->
						  <div class="dropdown-menu" id="dropdownMenu">
						  		<div class="user-location-container">
						  			<div class="email-container" th:text="${email}"> </div>
						  			<div class="profile-img-location-container">
								  		<img th:src="@{/images/default-profile.png}" alt="프로필 이미지" class="profile-image" />
						  			</div>
							  		<div class="user-name" th:text="${nickname} + '님 환영합니다.'">OOO님 환영합니다.</div>
							  		<div class="user-btn-container">
								    	<a th:href="@{/mypage}" class="dropdown-item1">마이페이지</a>
								    	<a th:href="@{/logout}" class="dropdown-item2">로그아웃</a>
							  		</div>
						  		</div>
						  </div>
	  				</div>     
	  			</div>
	        </div>
	    </div>
	</div>

    <div class="AI-position-container">
        <div class="AI-container">
        	<a class ="AI=button" id="aiButton"><img th:src="@{/images/AI.png}" class="AI-image"/></a>
        </div>
    </div>

    <div class="top-button-position-container">
        <button class ="top-button">TOP</button>
    </div>
    <!-- ai모달 구조 -->
    <div class="gpt-modal-overlay" id="gptModal">
        <div class="gpt-modal-content">
            <div class="gpt-modal-header">
                <span>AI 챗봇</span>
                <button class="gpt-close-btn" id="closeModal">&times;</button>
            </div>
            <div class="gpt-chat-body" id="chatBody">
                <p>안녕하세요, 무엇을 도와드릴까요?</p>
            </div>
            <div class="gpt-input-area">
                <input type="text" id="userInput" placeholder="메시지를 입력하세요..." />
                <button id="sendBtn">전송</button>
            </div>
        </div>
    </div>
    
 <script>
	const topButtonContainer = document.querySelector('.top-button-position-container');
	const topButton = document.querySelector('.top-button');
	
	topButtonContainer.style.display = 'none';
	// 스크롤 감지: 300px 이상 내려가면 버튼 보이기
	window.addEventListener('scroll', () => {
	    if (window.scrollY > 300) {
	        topButtonContainer.style.display = 'block';
	    } else {
	        topButtonContainer.style.display = 'none';
	    }
	});
	
	// 클릭 시 부드럽게 맨 위로 이동
	topButton.addEventListener('click', () => {
	    window.scrollTo({
	        top: 0,
	        behavior: 'smooth'
	    });
	});
	
	// 모달창 제어 구조
	const aiButton = document.getElementById('aiButton');
    const gptModal = document.getElementById('gptModal');
    const closeModal = document.getElementById('closeModal');

    aiButton.addEventListener('click', () => {
        gptModal.style.display = 'flex';
    });
    closeModal.addEventListener('click', () => {
        gptModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
        if (e.target === gptModal) gptModal.style.display = 'none';
    });

    // 대화 시뮬레이션
    const sendBtn = document.getElementById('sendBtn');
    const userInput = document.getElementById('userInput');
    const chatBody = document.getElementById('chatBody');

    sendBtn.addEventListener('click', () => {
        const text = userInput.value.trim();
        if (text) {
            chatBody.innerHTML += `<p><strong>나:</strong> ${text}</p>`;
            userInput.value = '';
            setTimeout(() => {
                chatBody.innerHTML += `<p> AI: "${text}"에 대한 답변입니다.</p>`;
                chatBody.scrollTop = chatBody.scrollHeight;
            }, 500);
        }
    });

    userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') sendBtn.click();
    });
    

 </script>
 <script>
document.addEventListener('DOMContentLoaded', function() {
  const profileBtn = document.getElementById('profileBtn');
  const dropdownMenu = document.getElementById('dropdownMenu');

  let isOpen = false;

  // ✅ 클릭 시 토글
  profileBtn.addEventListener('click', function(event) {
    event.stopPropagation();
    isOpen = !isOpen;
    dropdownMenu.style.display = isOpen ? 'flex' : 'none';
    updateDropdownPosition();
  });

  // ✅ 스크롤할 때 위치 갱신
  window.addEventListener('scroll', function() {
    if (isOpen) updateDropdownPosition();
  });

  // ✅ 화면 크기 변경 시에도 갱신
  window.addEventListener('resize', function() {
    if (isOpen) updateDropdownPosition();
  });

  // ✅ 드롭다운 바깥 클릭 시 닫기
  document.addEventListener('click', function() {
    dropdownMenu.style.display = 'none';
    isOpen = false;
  });

  // ✅ 위치 계산 함수
  function updateDropdownPosition() {
    const rect = profileBtn.getBoundingClientRect();
    dropdownMenu.style.position = 'fixed';
    dropdownMenu.style.top = `${rect.bottom + 5}px`;
    dropdownMenu.style.left = `${rect.left + window.scrollX - (dropdownMenu.offsetWidth - rect.width)}px`;
  }
});
</script>

</header>
</body>
</html>
