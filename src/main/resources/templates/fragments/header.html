<!-- src/main/resources/templates/fragments/header.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="UTF-8">
<head>
    <!-- ì™¸ë¶€ CSS íŒŒì¼ ì—°ê²° -->
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    
</head>
<body>
<header th:fragment="siteHeader">
	<div class="header-wrapper">
	    <div class="header-top">
	    	<div class ="header-top-right">
		        <a th:href="@{/main}" class="logo"><img th:src="@{/images/logo2.png}" class="logo-image"/></a>
		        <!-- ì¹´í…Œê³ ë¦¬ ë©”ë‰´ -->
		        <div class="categori-container">
		            <a th:href="@{/main}" th:classappend="${activeMenu == 'main'} ? ' active' : ''">ë©”ì¸í™”ë©´</a>
		            <a th:href="@{/notion/precreate}" th:classappend="${activeMenu == 'notionCreate'} ? ' active' : ''">ë…¸íŠ¸ì‘ì„±</a>
		            <a th:href="@{/notion/manage}" th:classappend="${activeMenu == 'notionManage'} ? ' active' : ''">ë…¸íŠ¸ê´€ë¦¬</a>
		            <a th:href="@{/exam/create}" th:classappend="${activeMenu == 'quizCreate'} ? ' active' : ''">ë¬¸ì œìƒì„±</a>
		            <a th:href="@{/exam/my-results}" th:classappend="${activeMenu == 'examList'} ? ' active' : ''">ì‹œí—˜ëª©ë¡</a>
		            
		            <a th:href="@{/schedule}" th:classappend="${activeMenu == 'schedule'} ? ' active' : ''">ì¼ì •ê´€ë¦¬</a>
		            <a th:href="@{/recomLecture}" th:classappend="${activeMenu == 'recomLecture'} ? active : ''">ê°•ì˜ëª©ë¡</a>
		            <a th:href="@{/market}" th:classappend="${activeMenu == 'market'} ? active : ''">ë§ˆì¼“ì´ë™</a>
		        </div>
		
	    	</div>
	        <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¥¸ ë²„íŠ¼ -->
	        <div class="login-container">
	            <div sec:authorize="isAnonymous()">
	                <a th:href="@{/login}" class="login-button">ë¡œê·¸ì¸</a>
	            </div>
	            <div sec:authorize="isAuthenticated()" class="login-button-location">
	            	<div class="out-user-name" th:text="${nickname} + 'ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.'">OOOë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
	            	<div class="userProfile-container">
						  <button class="userProfile-btn" id="profileBtn">
						    <img th:src="@{/images/default-profile.png}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="user-image-container" />
						  </button>
	
						  <!-- â–¼ í´ë¦­ ì‹œ ë‚˜íƒ€ë‚  ë“œë¡­ë‹¤ìš´ -->
						  <div class="dropdown-menu" id="dropdownMenu">
						  		<div class="user-location-container">
						  			<div class="email-container" th:text="${email}"> </div>
						  			<div class="profile-img-location-container">
								  		<img th:src="@{/images/default-profile.png}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" class="profile-image" />
						  			</div>
							  		<div class="user-name" th:text="${nickname} + 'ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.'">OOOë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.</div>
							  		<div class="point-container">
								  		<div class="user-credit" th:text="9999"></div><div>ğŸª™</div>
								  		<div class="user-gold" th:text="9999 "></div><div>ğŸ’</div>
							  		</div>
							  		<div class="user-btn-container">
								    	<a th:href="@{/mypage}" class="dropdown-item1">ë§ˆì´í˜ì´ì§€</a>
								    	<a th:href="@{/logout}" class="dropdown-item2">ë¡œê·¸ì•„ì›ƒ</a>
							  		</div>
						  		</div>
						  </div>
	  				</div>     
			  		<button id="theme-toggle-btn" class="mode-changeBtn"></button>
	  			</div>
	        </div>
	    </div>
	</div>

    <div class="AI-position-container">
        <div class="AI-container">
        	<a class ="AI=button" id="aiButton"><img th:src="@{/images/AI.png}" class="AI-image"/></a>
        </div>
    </div>

    <div class="top-button-position-container">
        <button class ="top-button">TOP</button>
    </div>
    <!-- aiëª¨ë‹¬ êµ¬ì¡° -->
	<div class="gpt-modal-overlay" id="gptModal" sec:authorize="isAuthenticated()">
		<div class="gpt-modal-content">
			<div class="gpt-modal-header">
				<span>AI í•™ìŠµ ë„ìš°ë¯¸</span>
				<div style="display: flex; gap: 10px; align-items: center;">
					<button onclick="startNewChat()" style="background: none; border: none; color: white; cursor: pointer; font-size: 0.9rem;">
						ğŸ”„ ìƒˆ ëŒ€í™”
					</button>
					<button class="gpt-close-btn" id="closeModal">Ã—</button>
				</div>
			</div>
			<div class="gpt-chat-body" id="chatBody">
				<div class="message bot">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
			</div>
			<div class="gpt-input-area">
				<input type="text" id="userInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
				<button id="sendBtn">ì „ì†¡</button>
			</div>
		</div>
	</div>
    
 <script>
	const topButtonContainer = document.querySelector('.top-button-position-container');
	const topButton = document.querySelector('.top-button');
	
	topButtonContainer.style.display = 'none';
	// ìŠ¤í¬ë¡¤ ê°ì§€: 300px ì´ìƒ ë‚´ë ¤ê°€ë©´ ë²„íŠ¼ ë³´ì´ê¸°
	window.addEventListener('scroll', () => {
	    if (window.scrollY > 300) {
	        topButtonContainer.style.display = 'block';
	    } else {
	        topButtonContainer.style.display = 'none';
	    }
	});
	
	// í´ë¦­ ì‹œ ë¶€ë“œëŸ½ê²Œ ë§¨ ìœ„ë¡œ ì´ë™
	topButton.addEventListener('click', () => {
	    window.scrollTo({
	        top: 0,
	        behavior: 'smooth'
	    });
	});

document.addEventListener('DOMContentLoaded', function() {
  const profileBtn = document.getElementById('profileBtn');
  const dropdownMenu = document.getElementById('dropdownMenu');

  let isOpen = false;

  // âœ… í´ë¦­ ì‹œ í† ê¸€
  profileBtn.addEventListener('click', function(event) {
    event.stopPropagation();
    isOpen = !isOpen;
    dropdownMenu.style.display = isOpen ? 'flex' : 'none';
    updateDropdownPosition();
  });

  // âœ… ìŠ¤í¬ë¡¤í•  ë•Œ ìœ„ì¹˜ ê°±ì‹ 
  window.addEventListener('scroll', function() {
    if (isOpen) updateDropdownPosition();
  });

  // âœ… í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œì—ë„ ê°±ì‹ 
  window.addEventListener('resize', function() {
    if (isOpen) updateDropdownPosition();
  });

  // âœ… ë“œë¡­ë‹¤ìš´ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
  document.addEventListener('click', function() {
    dropdownMenu.style.display = 'none';
    isOpen = false;
  });

  // âœ… ìœ„ì¹˜ ê³„ì‚° í•¨ìˆ˜
  function updateDropdownPosition() {
    const rect = profileBtn.getBoundingClientRect();
    dropdownMenu.style.position = 'fixed';
    dropdownMenu.style.top = `${rect.bottom + 5}px`;
    dropdownMenu.style.left = `${rect.left + window.scrollX - (dropdownMenu.offsetWidth - rect.width)}px`;
  }
});
</script>
<script>
	
</script>
	<script th:src="@{/js/chatbot.js}"></script>
</header>
</body>
</html>
