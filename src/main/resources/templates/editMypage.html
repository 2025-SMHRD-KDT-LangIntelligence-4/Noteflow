<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ë§ˆì´í˜ì´ì§€ ìˆ˜ì •</title>
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link rel="stylesheet" th:href="@{/css/footer.css}" />
<link id="theme-css" rel="stylesheet" th:href="@{/css/editmypage.css}" />
<script>
document.addEventListener("DOMContentLoaded", () => {
  const themeLink = document.getElementById("theme-css");
  const themeToggleBtn = document.getElementById("theme-toggle-btn");

  // ì €ì¥ëœ ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
  const savedTheme = localStorage.getItem("theme") || "light";

  // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ (ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ íŒë‹¨)
  const isLoggedIn = !!themeToggleBtn;

  if (isLoggedIn) {
    // ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ì €ì¥ëœ í…Œë§ˆ ì ìš©
    applyTheme(savedTheme);

    // ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤í¬ëª¨ë“œ ì „í™˜
    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
    });
  } else {
    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” í•­ìƒ ë¼ì´íŠ¸ëª¨ë“œ ì ìš©
    applyTheme("light");
  }

  function applyTheme(mode) {
    if (mode === "dark") {
      themeLink.setAttribute("href", "/CSSDARK/editMypage.css");
      localStorage.setItem("theme", "dark");
      if (themeToggleBtn) themeToggleBtn.textContent = "â˜€ï¸";
    } else {
      themeLink.setAttribute("href", "/css/editmypage.css");
      localStorage.setItem("theme", "light");
      if (themeToggleBtn) themeToggleBtn.textContent = "ğŸŒ™";
    }
  }
});
</script>

	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
    <!-- í—¤ë” -->
    <div th:replace="~{fragments/header :: siteHeader}"></div>
	<div class="location-container">
	    <div class="mypage-container">
	        <div class="title">ë§ˆì´í˜ì´ì§€ ìˆ˜ì •</div>
	
	        <form th:action="@{/editMypage}" method="post"
	              enctype="multipart/form-data" onsubmit="return validatePassword()">
	
	            <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
	            <div class="profile-image-container">
	                <img id="preview" alt="í”„ë¡œí•„ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°"
	                     th:src="${#strings.isEmpty(user?.profileImage)} ? @{/images/default-profile.png} : @{${user.profileImage}}" />
	                <input type="file" name="profileImage" accept="image/*" onchange="previewImage(event)"/>
	                <div>
	                    <label>
	                        <input type="checkbox" name="deleteProfileImage" value="true" onchange="toggleDeleteProfile(this)" />
	                        ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ
	                    </label>
	                </div>
	            </div>
	
	            <!-- ìœ ì € ì •ë³´ -->
	            <div class="user-info-container">
	                
	                <div class="user-info-item">
	                    <label for="nickname">ë‹‰ë„¤ì„</label>
	                    <input type="text" id="nickname" name="nickname" th:value="${user?.nickname}" required>
	                </div>
	
	                <div class="user-info-item">
	                    <label for="userEmail">ì´ë©”ì¼</label>
	                    <div class="email-check-container">
	                        <input type="email" id="userEmail" name="userEmail" th:value="${user?.email}" required>
	                        <button type="button" onclick="checkEmailDuplicate()" class="check-id-button">ì¤‘ë³µ í™•ì¸</button>
	                    </div>
	                </div>
	
	                <div class="user-info-item">
	                    <label for="currentPw">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
	                    <input type="password" id="currentPw" name="currentPw" placeholder="í•„ìˆ˜ ì…ë ¥">
	                </div>
	
	                <div class="user-info-item">
	                    <label for="userPw">ë¹„ë°€ë²ˆí˜¸</label>
	                    <input type="password" id="userPw" name="userPw" placeholder="ë³€ê²½í•  ê²½ìš°ì—ë§Œ ì…ë ¥">
	                </div>
	
	                <div class="user-info-item">
	                    <label for="userPwConfirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
	                    <input type="password" id="userPwConfirm" name="userPwConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
	                </div>
	
	                <div class="user-info-item">
	                    <label for="userInterest">ê´€ì‹¬ ë¶„ì•¼</label>
	                    <input type="text" id="userInterest" name="interestArea" th:value="${user?.interestArea}">
	                </div>
	
	                <div class="user-info-item">
	                    <label for="learningArea">í•™ìŠµ ì¤‘ì¸ ë¶„ì•¼</label>
	                    <input type="text" id="learningArea" name="learningArea" th:value="${user?.learningArea}">
	                </div>
	
	                <div class="user-info-item">
	                    <label>
	                        <input type="checkbox" name="mailingAgreed" th:checked="${user?.mailingAgreed}" />
	                        ì´ë©”ì¼ ìˆ˜ì‹  ë™ì˜
	                    </label>
	                </div>
	
	                <div class="user-info-item">
	                    <label for="bio">ìê¸°ì†Œê°œ</label>
	                    <textarea id="bio" name="bio" th:text="${user?.bio}"></textarea>
	                </div>
	
	                <div class="user-info-item">
	                    <label>ê°€ì…ì¼</label>
	                    <span th:text="${user != null ? #temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm') : '-'}"></span>
	                    <br />
	                    <label>ìµœê·¼ ë¡œê·¸ì¸</label>
	                    <span th:text="${user?.lastLogin != null ? #temporals.format(user.lastLogin, 'yyyy-MM-dd HH:mm') : '-'}"></span>
	                </div>
	
	            </div>
	
	            <!-- ë²„íŠ¼ -->
	            <div class="button-container">
	                <button type="submit" class="info-save-button">ì €ì¥í•˜ê¸°</button>
	                <button type="button" class="info-cancel-button" onclick="window.location.href='/mypage'">ì·¨ì†Œ</button>
	                <button type="button" class="info-delete-button" onclick="deleteAccount()">ê³„ì • ì‚­ì œ</button>
	            </div>
	
	        </form>
	    </div>
	</div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: siteFooter}"></div>

    <!-- JS -->
    <script th:src="@{/js/editmypage.js}"></script>
</body>
</html>
