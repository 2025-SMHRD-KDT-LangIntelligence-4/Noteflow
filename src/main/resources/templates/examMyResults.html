<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 시험 기록</title>
    <link rel="stylesheet" th:href="@{/css/examMyResults.css}">
    <script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // 저장된 모드 불러오기
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // 로그인 상태에서는 저장된 테마 적용
		    applyTheme(savedTheme);
		
		    // 버튼 클릭 시 다크모드 전환
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // 로그아웃 상태에서는 항상 라이트모드 적용
		    applyTheme("light");
		  }
		
		  // ✅ 테마 적용 함수
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/examMyResults.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/examMyResults.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
		      }
		    }
		  }
		});
	</script>
    
        <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <meta name="csrf" th:content="${_csrf?.token}">
    <meta name="csrf-header" th:content="${_csrf?.headerName}">
</head>
<body>
    <!-- Header 포함 -->
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="page-wrapper">
        <div class="results-container">
            <!-- 헤더 -->
            <div class="page-header">
                <h1 class="page-title">내 시험 기록</h1>
                <button class="btn-create-exam" onclick="location.href='/exam/create'">
                    + 새 시험 만들기
                </button>
            </div>

            <!-- 시험 결과 없을 때 -->
            <div th:if="${#lists.isEmpty(results)}" class="empty-state">
                <div class="empty-icon">📝</div>
                <p class="empty-message">아직 응시한 시험이 없습니다.</p>
                <button class="btn-empty-action" onclick="location.href='/exam/create'">
                    첫 시험 만들기
                </button>
            </div>

            <!-- 시험 결과 목록 -->
            <div th:if="${!#lists.isEmpty(results)}" class="results-grid">
                <div th:each="result : ${results}" class="result-card"
                     th:classappend="${result.passed} ? 'passed' : 'failed'">
                    
                    <!-- 상단: 제목 & 날짜 -->
                    <div class="card-header">
                        <h3 class="card-title" th:text="${result.testTitle}">시험 제목</h3>
                        <span class="card-date" 
                              th:text="${#temporals.format(result.createdAt, 'yyyy-MM-dd HH:mm')}">
                            2025-10-22 11:30
                        </span>
                    </div>

                    <!-- 설명 -->
                    <p class="card-desc" th:text="${result.testDesc}">키워드: Python, Database</p>

                    <!-- 점수 & 정답률 -->
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">점수</span>
                            <span class="stat-value">
                                <span th:text="${result.userScore}">15</span>
                                <span class="stat-divider">/</span>
                                <span th:text="${result.totalScore}">20</span>
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">정답률</span>
                            <span class="stat-value" 
                                  th:text="${#numbers.formatDecimal(result.accuracy, 1, 1)} + '%'">
                                75.0%
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">난이도</span>
                            <span class="stat-value" th:text="'Level ' + ${result.difficulty}">Level 2</span>
                        </div>
                    </div>

                    <!-- 정답/오답 개수 -->
                    <div class="card-answer-summary">
                        <span class="answer-correct">
                            ✓ <span th:text="${result.correctCount}">6</span>개 정답
                        </span>
                        <span class="answer-wrong">
                            ✗ <span th:text="${result.wrongCount}">3</span>개 오답
                        </span>
                    </div>

                    <!-- 합격/불합격 배지 -->
                    <div class="card-badge">
                        <span th:if="${result.passed}" class="badge-passed">합격</span>
                        <span th:if="${!result.passed}" class="badge-failed">불합격</span>
                    </div>

                    <!-- 액션 버튼 -->
                    <div class="card-actions">
                        <button class="btn-view-result" 
                                th:onclick="|location.href='/exam/result/${result.resultIdx}'|">
                            결과 보기
                        </button>
                        <button class="btn-view-explanation"
                                th:onclick="|location.href='/exam/explanation/${result.resultIdx}'|">
                            해설 보기
                        </button>
                    </div>
                </div>
            </div>

            <!-- 페이지네이션 -->
            <div th:if="${!#lists.isEmpty(results)}" class="pagination">
                <button th:if="${currentPage > 0}" 
                        class="btn-page"
                        th:onclick="|location.href='/exam/my-results?page=${currentPage - 1}'|">
                    ← 이전
                </button>
                <span class="page-info" th:text="${currentPage + 1} + ' 페이지'">1 페이지</span>
                <button th:if="${hasMore}" 
                        class="btn-page"
                        th:onclick="|location.href='/exam/my-results?page=${currentPage + 1}'|">
                    다음 →
                </button>
            </div>
        </div>
    </div>
</body>
</html>
