<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚´ ì‹œí—˜ ê¸°ë¡</title>
    <link rel="stylesheet" th:href="@{/css/examMyResults.css}">
    <script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // ì €ì¥ëœ ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ (ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ íŒë‹¨)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ì €ì¥ëœ í…Œë§ˆ ì ìš©
		    applyTheme(savedTheme);
		
		    // ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤í¬ëª¨ë“œ ì „í™˜
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” í•­ìƒ ë¼ì´íŠ¸ëª¨ë“œ ì ìš©
		    applyTheme("light");
		  }
		
		  // âœ… í…Œë§ˆ ì ìš© í•¨ìˆ˜
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/examMyResults.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // ë²„íŠ¼ ì´ë™ í´ë˜ìŠ¤ ì¶”ê°€
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/examMyResults.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // ê¸°ë³¸ ìœ„ì¹˜ë¡œ ë³µê·€
		      }
		    }
		  }
		});
	</script>
    
        <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <meta name="csrf" th:content="${_csrf?.token}">
    <meta name="csrf-header" th:content="${_csrf?.headerName}">
</head>
<body>
    <!-- Header í¬í•¨ -->
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="page-wrapper">
        <div class="results-container">
            <!-- í—¤ë” -->
            <div class="page-header">
                <h1 class="page-title">ë‚´ ì‹œí—˜ ê¸°ë¡</h1>
                <button class="btn-create-exam" onclick="location.href='/exam/create'">
                    + ìƒˆ ì‹œí—˜ ë§Œë“¤ê¸°
                </button>
            </div>

            <!-- ì‹œí—˜ ê²°ê³¼ ì—†ì„ ë•Œ -->
            <div th:if="${#lists.isEmpty(results)}" class="empty-state">
                <div class="empty-icon">ğŸ“</div>
                <p class="empty-message">ì•„ì§ ì‘ì‹œí•œ ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <button class="btn-empty-action" onclick="location.href='/exam/create'">
                    ì²« ì‹œí—˜ ë§Œë“¤ê¸°
                </button>
            </div>

            <!-- ì‹œí—˜ ê²°ê³¼ ëª©ë¡ -->
            <div th:if="${!#lists.isEmpty(results)}" class="results-grid">
                <div th:each="result : ${results}" class="result-card"
                     th:classappend="${result.passed} ? 'passed' : 'failed'">
                    
                    <!-- ìƒë‹¨: ì œëª© & ë‚ ì§œ -->
                    <div class="card-header">
                        <h3 class="card-title" th:text="${result.testTitle}">ì‹œí—˜ ì œëª©</h3>
                        <span class="card-date" 
                              th:text="${#temporals.format(result.createdAt, 'yyyy-MM-dd HH:mm')}">
                            2025-10-22 11:30
                        </span>
                    </div>

                    <!-- ì„¤ëª… -->
                    <p class="card-desc" th:text="${result.testDesc}">í‚¤ì›Œë“œ: Python, Database</p>

                    <!-- ì ìˆ˜ & ì •ë‹µë¥  -->
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">ì ìˆ˜</span>
                            <span class="stat-value">
                                <span th:text="${result.userScore}">15</span>
                                <span class="stat-divider">/</span>
                                <span th:text="${result.totalScore}">20</span>
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ì •ë‹µë¥ </span>
                            <span class="stat-value" 
                                  th:text="${#numbers.formatDecimal(result.accuracy, 1, 1)} + '%'">
                                75.0%
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">ë‚œì´ë„</span>
                            <span class="stat-value" th:text="'Level ' + ${result.difficulty}">Level 2</span>
                        </div>
                    </div>

                    <!-- ì •ë‹µ/ì˜¤ë‹µ ê°œìˆ˜ -->
                    <div class="card-answer-summary">
                        <span class="answer-correct">
                            âœ“ <span th:text="${result.correctCount}">6</span>ê°œ ì •ë‹µ
                        </span>
                        <span class="answer-wrong">
                            âœ— <span th:text="${result.wrongCount}">3</span>ê°œ ì˜¤ë‹µ
                        </span>
                    </div>

                    <!-- í•©ê²©/ë¶ˆí•©ê²© ë°°ì§€ -->
                    <div class="card-badge">
                        <span th:if="${result.passed}" class="badge-passed">í•©ê²©</span>
                        <span th:if="${!result.passed}" class="badge-failed">ë¶ˆí•©ê²©</span>
                    </div>

                    <!-- ì•¡ì…˜ ë²„íŠ¼ -->
                    <div class="card-actions">
                        <button class="btn-view-result" 
                                th:onclick="|location.href='/exam/result/${result.resultIdx}'|">
                            ê²°ê³¼ ë³´ê¸°
                        </button>
                        <button class="btn-view-explanation"
                                th:onclick="|location.href='/exam/explanation/${result.resultIdx}'|">
                            í•´ì„¤ ë³´ê¸°
                        </button>
                    </div>
                </div>
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div th:if="${!#lists.isEmpty(results)}" class="pagination">
                <button th:if="${currentPage > 0}" 
                        class="btn-page"
                        th:onclick="|location.href='/exam/my-results?page=${currentPage - 1}'|">
                    â† ì´ì „
                </button>
                <span class="page-info" th:text="${currentPage + 1} + ' í˜ì´ì§€'">1 í˜ì´ì§€</span>
                <button th:if="${hasMore}" 
                        class="btn-page"
                        th:onclick="|location.href='/exam/my-results?page=${currentPage + 1}'|">
                    ë‹¤ìŒ â†’
                </button>
            </div>
        </div>
    </div>
</body>
</html>
