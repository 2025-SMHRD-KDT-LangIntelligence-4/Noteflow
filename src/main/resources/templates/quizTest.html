<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>시험 풀기</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link id="theme-css" rel="stylesheet" th:href="@{/css/quizTest.css}">
    <script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // 저장된 모드 불러오기
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // 로그인 상태에서는 저장된 테마 적용
		    applyTheme(savedTheme);
		
		    // 버튼 클릭 시 다크모드 전환
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // 로그아웃 상태에서는 항상 라이트모드 적용
		    applyTheme("light");
		  }
		
		  // ✅ 테마 적용 함수
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/quizTest.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/quizTest.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
		      }
		    }
		  }
		});
	</script>
    
      <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="~{fragments/header :: siteHeader}"></div>

<div class="full-location-container">
    <div class="full-container">
        <div class="quiz-header">
            <div class="left-arrow">
                <button id="prevBtn">
                    <img th:src="@{/images/arrowVector.svg}" class="arrow1">
                </button>
            </div>
            <div id="quizNumber" class="quiz-number"></div>
            <div id="quizTitle" class="quiz-title"></div>
            <div class="right-arrow">
                <button id="nextBtn">
                    <img th:src="@{/images/arrowVector.svg}" class="arrow2">
                </button>
            </div>
        </div>

        <div class="quiz-text-container">
            <div id="quizText" class="quiz-text">...</div>
        </div>

        <div id="quizAnswerContainer" class="quiz-answer-container">
            <!-- JS에서 동적 생성 -->
        </div>

        <div class="submit-container">
            <!-- ⭐ 제출 버튼 텍스트 추가 ⭐ -->
            <button id="submitBtn">제출하기</button>
        </div>
    </div>
</div>
<input type="hidden" id="csrfToken" th:value="${_csrf.token}"/>
<input type="hidden" id="csrfHeader" th:value="${_csrf.headerName}"/>
<div th:replace="~{fragments/footer :: siteFooter}"></div>

<!-- ⭐ 데이터 주입 ⭐ -->
<script th:inline="javascript">
    /*<![CDATA[*/
    let questions = /*[[${questionsJson}]]*/ '[]';
    try {
        questions = JSON.parse(questions);
        if (!Array.isArray(questions)) {
            questions = [];
        }
    } catch(e) {
        console.error('questionsJson parsing error:', e);
        questions = [];
    }

    let testIdx = /*[[${test.testIdx}]]*/ 0;
    let startTime = new Date().toISOString();
    /*]]>*/
</script>


<script src="/js/quizTest.js"></script>
</body>
</html>
