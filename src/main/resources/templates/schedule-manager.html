<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<title>스케줄 관리 달력</title>

<link
	href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css"
	rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

<link id="theme-css" rel="stylesheet" th:href="@{/css/schedule-manager.css}" />
<script>
document.addEventListener("DOMContentLoaded", () => {
  const themeLink = document.getElementById("theme-css");
  const themeToggleBtn = document.getElementById("theme-toggle-btn");

  // 저장된 모드 불러오기
  const savedTheme = localStorage.getItem("theme") || "light";

  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
  const isLoggedIn = !!themeToggleBtn;

  if (isLoggedIn) {
    // 로그인 상태에서는 저장된 테마 적용
    applyTheme(savedTheme);

    // 버튼 클릭 시 다크모드 전환
    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
    });
  } else {
    // 로그아웃 상태에서는 항상 라이트모드 적용
    applyTheme("light");
  }

  // ✅ 테마 적용 함수
  function applyTheme(mode) {
    if (mode === "dark") {
      themeLink.setAttribute("href", "/CSSDARK/schedule-manager.css");
      localStorage.setItem("theme", "dark");
      if (themeToggleBtn) {
        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
      }
    } else {
      themeLink.setAttribute("href", "/css/schedule-manager.css");
      localStorage.setItem("theme", "light");
      if (themeToggleBtn) {
        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
      }
    }
  }
});
</script>
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link rel="stylesheet" th:href="@{/css/footer.css}" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
	<div th:replace="~{fragments/header :: siteHeader}"></div>

	<div class="location-container">
		<div class="main-content-wrapper">

			<div class="calendar-wrapper">
				<div class="calendar-container">
					<div id="calendar"></div>
				</div>
			</div>

			<div id="scheduleSidebar" class="schedule-sidebar">
				<div class="sidebar-section search-section">
					<h3>일정 검색</h3>
					<div class="search-input-group">
						<input type="text" id="scheduleSearchInput"
							placeholder="제목, 내용으로 검색" />
						<button id="searchButton" class="icon-btn">🔍</button>
						<button id="searchResetButton" class="icon-btn" title="검색 초기화">⟲</button>
					</div>
				</div>
				<div>
					<button id="openDeleteCenterBtn" class="btn danger"
						style="margin-left: 8px;">🗑️ 삭제</button>
					<button id="openTrashBtn" class="btn secondary" title="휴지통/복구">♻️
						복구</button>
				</div>
				<div class="sidebar-section filter-section">
					<h3>카테고리 필터</h3>
					<div class="filter-category-list" id="categoryFilterList">
						<span class="category-tag active" data-filter="all">#전체</span> <span
							class="category-tag" data-filter="java">@Java</span> <span
							class="category-tag" data-filter="python">@Python</span> <span
							class="category-tag input-placeholder">+ 직접 입력</span>
					</div>
				</div>

				<div class="sidebar-section temp-section">
					<h3>임시 저장 일정</h3>
					<div id="tempScheduleContainer" class="temp-schedule-list">
						<div class="no-temp-schedules">저장된 임시 일정이 없습니다.</div>
					</div>
				</div>
			</div>

		</div>

	</div>

	<div th:replace="~{fragments/schedule-dropdown-ui :: quickAddModal}"></div>
	<div th:replace="~{fragments/schedule-dropdown-ui :: editModal}"></div>
	<script
		src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales/ko.global.min.js"></script>
	<script type="module" src="/js/schedule-utils.js"></script>
	<script type="module" src="/js/schedule-ui-dropdown.js"></script>
	<script type="module" src="/js/schedule-quick-add.js"></script>
	<script type="module" src="/js/schedule-manager.js"></script>
	<script type="module" src="/js/schedule-edit.js"></script>

	<div th:replace="~{fragments/footer :: siteFooter}"></div>
</body>
</html>