<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" th:href="@{/css/header.css}" />
<link id="theme-css" rel="stylesheet" th:href="@{/css/Main.css}" />
<script>
document.addEventListener("DOMContentLoaded", () => {
  const themeLink = document.getElementById("theme-css");
  const themeToggleBtn = document.getElementById("theme-toggle-btn");

  // 저장된 모드 불러오기
  const savedTheme = localStorage.getItem("theme") || "light";

  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
  const isLoggedIn = !!themeToggleBtn;

  if (isLoggedIn) {
    // 로그인 상태에서는 저장된 테마 적용
    applyTheme(savedTheme);

    // 버튼 클릭 시 다크모드 전환
    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
    });
  } else {
    // 로그아웃 상태에서는 항상 라이트모드 적용
    applyTheme("light");
  }

  // ✅ 테마 적용 함수
  function applyTheme(mode) {
    if (mode === "dark") {
      themeLink.setAttribute("href", "/CSSDARK/Maindark.css");
      localStorage.setItem("theme", "dark");
      if (themeToggleBtn) {
        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
      }
    } else {
      themeLink.setAttribute("href", "/css/Main.css");
      localStorage.setItem("theme", "light");
      if (themeToggleBtn) {
        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
      }
    }
  }
});
</script>
<link rel="stylesheet" th:href="@{/css/footer.css}" />
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<!-- 헤더 -->
    <div th:replace="fragments/header :: siteHeader"></div>
    
	<div class="full-location-container">
		<div class="ad-banner-wrapper">
		  <div class="ad-banner">
		    <div class="ad-slide fade">
		      <img class="ad-banner-img" th:src="@{/images/sns_thm.jpg}" alt="광고1" style="background:#0090CF;">
		      <a href="https://lms.smhrd.or.kr/home/main/indexMain" target="_blank" class="smhrd-link">페이지바로가기</a>
		    </div>
		    <div class="ad-slide fade">
		      <img class="ad-banner-img" 
		      th:src="@{/images/smhrd-ad.png}" alt="광고2"
		      style="background:#02021E;"
		      >
		      <a href="https://smhrd.or.kr/?gad_source=1&gad_campaignid=23036586174&gbraid=0AAAAA-Q0118M7R0F6vDPw3ituxJ54gY95&gclid=CjwKCAjwjffHBhBuEiwAKMb8pLPi8ydSwT99Ozs0rYdC0tNwUcx8toc7BkX7qnXYrz0Sq_Kc3oy7QRoCl0QQAvD_BwE" target="_blank" class="ad2-link">지금 보러가기</a>
		    </div>
		    <div class="ad-slide fade" style="background:white;">
		      <img class="ad-banner-img" th:src="@{/images/qnet.jpg}" alt="광고3" style="background:white; width:70%">
		      <div class="ad-pre">
			      <span style="font-size:50px; font-weight:bold;">국가자격증</span>
			      <span>원서 접수부터</span>
			      <span>자격증 발급까지!</span>
			      <span style="font-size:40px;">큐넷에서 한큐에!</span>
		      </div>
		      <a href="https://www.q-net.or.kr/man001.do?gSite=Q&gIntro=Y" target="_blank" class="ad3-link">큐넷 바로가기</a>
		    </div>
		
		    <!-- 좌우 버튼 -->
		    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
		    <a class="next" onclick="plusSlides(1)">&#10095;</a>
		  </div>
		
		  <!-- 점 네비게이션 -->
		  <div class="dots">
		    <span class="dot" onclick="currentSlide(1)"></span>
		    <span class="dot" onclick="currentSlide(2)"></span>
		    <span class="dot" onclick="currentSlide(3)"></span>
		  </div>
		</div>
		<div class="full-location-container">    
    <section id="main-feature-slider">   
	        <div class="head">
	    
	            <h2>새김AI 핵심 기능으로 학습의 질을 높여보세요!</h2>
	            <div class="controls">
	                <button id="prev-main" class="nav-btn" aria-label="이전">&#10094;</button>            
	                <button id="next-main" class="nav-btn" aria-label="다음">&#10095;</button>
	            </div>
	            
	        </div>
	    	<div class="slider">
	            <div class="track" id="track-main"> 	    
	                <article class="project-card" active>
	                    <img class="project-card__bg" th:src="@{/images/note.jpg}" alt="노트 배경 이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/memo.gif}" alt="노트 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">AI 노트 정리</h3>
	                            <p class="project-card__desc">
	                                <span th:if="${nickname != null and nickname != ''}" th:text="|${nickname}님, |"></span>
	                                <span>오늘의 학습 내용을 AI가 분석하여 정리해 드려요.</span>
	                            </p>
	                            <a th:href="@{/notion/create}" class="project-card__btn">노트 작성하러 가기</a>
	                        </div>
	                    </div>
	                </article>
	                <article class="project-card" active>
	                    <img class="project-card__bg" th:src="@{/images/noteManage.jpg}" alt="노트 관리 이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/noteManage.gif}" alt="노트 관리 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">작성 노트 관리</h3>
	                            <p class="project-card__desc">
	                                <span th:if="${nickname != null and nickname != ''}" th:text="|${nickname}님, |"></span>
	                                <span>작성된 노트들을 쉽게 관리해요!</span>
	                            </p>
	                            <a th:href="@{/notion/manage}" class="project-card__btn">작성된 노트 보러가기</a>
	                        </div>
	                    </div>
	                </article>	 	    
	                
	                <article class="project-card">
	                    <img class="project-card__bg" th:src="@{/images/test.jpg}" alt="문제생성 배경이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/test.gif}" alt="문제생성 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">문제 생성/테스트</h3>
	                            <p class="project-card__desc">
	                                <span>나만의 노트에 맞춰 생성된 문제를 풀어보세요</span>
	                            </p>
	                            <a th:href="@{/exam/create}" class="project-card__btn">문제생성가기</a>
	                        </div>
	                    </div>
	                </article>
	                <article class="project-card">
	                    <img class="project-card__bg" th:src="@{/images/lecture.jpg}" alt="강의목록 배경이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/lecture.gif}" alt="강의목록 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">강의목록</h3>
	                            <p class="project-card__desc">
	                                <span>부족한 학습은 강의로 채워보세요</span>
	                            </p>
	                            <a th:href="@{/recomLecture}" class="project-card__btn">문제생성가기</a>
	                        </div>
	                    </div>
	                </article>
	                <article class="project-card">
	                    <img class="project-card__bg" th:src="@{/images/calendar .jpg}" alt="캘린더 배경 이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/calendar.gif}" alt="캘린더 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">학습 스케줄</h3>
	                            <p class="project-card__desc">
	                                <span th:if="${nickname != null and nickname != ''}" th:text="|${nickname}님, |"></span>
	                                <span>개인 일정부터 학습 계획까지 한눈에 확인하고 관리하세요.</span>
	                            </p>
	                            <a th:href="@{/schedule}" class="project-card__btn">스케줄 확인하기</a>
	                        </div>
	                    </div>
	                </article>	    
	                
	                <article class="project-card">
	                    <img class="project-card__bg" th:src="@{/images/market.jpg}" alt="마켓 배경 이미지">
	                    <div class="project-card__content">
	                        <img class="project-card__thumb" th:src="@{/images/market.gif}" alt="마켓 아이콘">
	                        <div class="card-div">
	                            <h3 class="project-card__title">템플릿 마켓</h3>
	                            <p class="project-card__desc">
	                                <span>다양한 학습 스타일과 취향에 맞는 노트와 스케줄 템플릿을 만나보세요.</span>
	                            </p>
	                            <a th:href="@{/market}" class="project-card__btn">템플릿 마켓 가기</a>
	                        </div>
	                    </div>
	                </article>	  	  	    			  
	            </div>
	            <div class="dots" id="dots-main"></div>
	        </div>
	        </section>	        
	    </div>   
        
   
  	<div th:replace="fragments/footer :: siteFooter"></div>
</div>

	<script>
		let slideIndex = 0;
		showSlides();
		
		function showSlides() {
		  const slides = document.querySelectorAll(".ad-slide");
		  const dots = document.querySelectorAll(".dot");
		
		  slides.forEach(s => s.style.display = "none");
		  dots.forEach(d => d.classList.remove("active"));
		
		  slideIndex++;
		  if (slideIndex > slides.length) { slideIndex = 1; }
		
		  slides[slideIndex - 1].style.display = "flex";
		  dots[slideIndex - 1].classList.add("active");
		
		  setTimeout(showSlides, 4000); // 4초마다 자동 전환
		}
		
		// 수동 제어
		function plusSlides(n) {
		  showManualSlide(slideIndex += n);
		}
		
		function currentSlide(n) {
		  showManualSlide(slideIndex = n);
		}
		
		function showManualSlide(n) {
		  const slides = document.querySelectorAll(".ad-slide");
		  const dots = document.querySelectorAll(".dot");
		
		  if (n > slides.length) { slideIndex = 1; }
		  if (n < 1) { slideIndex = slides.length; }
		
		  slides.forEach(s => s.style.display = "none");
		  dots.forEach(d => d.classList.remove("active"));
		
		  slides[slideIndex - 1].style.display = "flex";
		  dots[slideIndex - 1].classList.add("active");
		}
		/* 기존 광고 슬라이드 JavaScript (showSlides, plusSlides, currentSlide, showManualSlide) 코드 아래에 추가 */

		// ----------------------------------------------------
		// ⚡️ 핵심 기능 슬라이더 JS (ID 변경)
		// ----------------------------------------------------
		(() => {
		    // ID를 track-main, prev-main, next-main, dots-main으로 변경
		    const track = document.getElementById("track-main");
		    if (!track) return; // 요소가 없으면 실행 중지 (안전 장치)
		    
		    const wrap = track.parentElement;
		    const cards = Array.from(track.children);
		    const prev = document.getElementById("prev-main");
		    const next = document.getElementById("next-main");
		    const dotsBox = document.getElementById("dots-main");

		    const isMobile = () => matchMedia("(max-width:767px)").matches;

		    cards.forEach((_, i) => {
		        const dot = document.createElement("span");
		        dot.className = "dot";
		        dot.onclick = () => activate(i, true);
		        dotsBox.appendChild(dot);
		    });
		    const dots = Array.from(dotsBox.children);

		    let current = 0;

		    function center(i) {
		        const card = cards[i];
		        // ... (center 함수 내용은 동일)
		        const axis = isMobile() ? "top" : "left";
		        const size = isMobile() ? "clientHeight" : "clientWidth";
		        const start = isMobile() ? card.offsetTop : card.offsetLeft;
		        wrap.scrollTo({
		            [axis]: start - (wrap[size] / 2 - card[size] / 2),
		            behavior: "smooth"
		        });
		    }

		    function toggleUI(i) {
		        // ... (toggleUI 함수 내용은 동일)
		        cards.forEach((c, k) => c.toggleAttribute("active", k === i));
		        dots.forEach((d, k) => d.classList.toggle("active", k === i));
		        prev.disabled = i === 0;
		        next.disabled = i === cards.length - 1;
		    }

		    function activate(i, scroll) {
		        // ... (activate 함수 내용은 동일)
		        if (i === current) return;
		        current = i;
		        toggleUI(i);
		        if (scroll) center(i);
		    }

		    function go(step) {
		        // ... (go 함수 내용은 동일)
		        activate(Math.min(Math.max(current + step, 0), cards.length - 1), true);
		    }

		    // 이벤트 리스너도 ID가 변경된 버튼에 연결
		    prev.onclick = () => go(-1);
		    next.onclick = () => go(1);

		    addEventListener(
		        "keydown",
		        (e) => {
		            if (["ArrowRight", "ArrowDown"].includes(e.key)) go(1);
		            if (["ArrowLeft", "ArrowUp"].includes(e.key)) go(-1);
		        },
		        { passive: true }
		    );

		    cards.forEach((card, i) => {
		        card.addEventListener(
		            "mouseenter",
		            () => matchMedia("(hover:hover)").matches && activate(i, true)
		        );
		        card.addEventListener("click", () => activate(i, true));
		    });

		    let sx = 0, sy = 0;
		    track.addEventListener(
		        "touchstart",
		        (e) => {
		            sx = e.touches[0].clientX;
		            sy = e.touches[0].clientY;
		        },
		        { passive: true }
		    );

		    track.addEventListener(
		        "touchend",
		        (e) => {
		            const dx = e.changedTouches[0].clientX - sx;
		            const dy = e.changedTouches[0].clientY - sy;
		            if (isMobile() ? Math.abs(dy) > 60 : Math.abs(dx) > 60)
		                go((isMobile() ? dy : dx) > 0 ? -1 : 1);
		        },
		        { passive: true }
		    );
		    if (window.matchMedia("(max-width:767px)").matches) dotsBox.hidden = true;

		    addEventListener("resize", () => center(current));

		    toggleUI(0);
		    center(0);
		})();
	</script>

</body>

</html>
