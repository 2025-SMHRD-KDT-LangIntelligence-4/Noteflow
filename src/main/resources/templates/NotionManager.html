<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>ì •ë¦¬ë³¸ ë° íŒŒì¼ ê´€ë¦¬</title>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/footer.css}" />
    <link id="theme-css" rel="stylesheet" th:href="@{/css/notionmanager.css}">
	<script>
		document.addEventListener("DOMContentLoaded", () => {
		  const themeLink = document.getElementById("theme-css");
		  const themeToggleBtn = document.getElementById("theme-toggle-btn");
		
		  // ì €ì¥ëœ ëª¨ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
		  const savedTheme = localStorage.getItem("theme") || "light";
		
		  // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ (ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ íŒë‹¨)
		  const isLoggedIn = !!themeToggleBtn;
		
		  if (isLoggedIn) {
		    // ë¡œê·¸ì¸ ìƒíƒœì—ì„œëŠ” ì €ì¥ëœ í…Œë§ˆ ì ìš©
		    applyTheme(savedTheme);
		
		    // ë²„íŠ¼ í´ë¦­ ì‹œ ë‹¤í¬ëª¨ë“œ ì „í™˜
		    themeToggleBtn.addEventListener("click", () => {
		      const current = localStorage.getItem("theme") || "light";
		      const next = current === "light" ? "dark" : "light";
		      applyTheme(next);
		    });
		  } else {
		    // ë¡œê·¸ì•„ì›ƒ ìƒíƒœì—ì„œëŠ” í•­ìƒ ë¼ì´íŠ¸ëª¨ë“œ ì ìš©
		    applyTheme("light");
		  }
		
		  // âœ… í…Œë§ˆ ì ìš© í•¨ìˆ˜
		  function applyTheme(mode) {
		    if (mode === "dark") {
		      themeLink.setAttribute("href", "/CSSDARK/notionmanager.css");
		      localStorage.setItem("theme", "dark");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.add("dark"); // ë²„íŠ¼ ì´ë™ í´ë˜ìŠ¤ ì¶”ê°€
		      }
		    } else {
		      themeLink.setAttribute("href", "/css/notionmanager.css");
		      localStorage.setItem("theme", "light");
		      if (themeToggleBtn) {
		        themeToggleBtn.classList.remove("dark"); // ê¸°ë³¸ ìœ„ì¹˜ë¡œ ë³µê·€
		      }
		    }
		  }
		});
	</script> 
	

    <!-- âœ… Toast UI Editor CDN ì¶”ê°€ -->
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <!-- âœ… SheetJS CDN ì¶”ê°€ (Excel íŒŒì¼ìš©) -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="page-wrapper">
    <div class="location-container">
        <!-- ì™¼ìª½: ë¦¬ìŠ¤íŠ¸ -->
        <div class="notion-list-container">
            <div class="tab-container">
                <button class="tab-button active" data-tab="notes">ğŸ“ ì •ë¦¬ë³¸</button>
                <button class="tab-button" data-tab="files">ğŸ“ ì›ë³¸íŒŒì¼</button>
            </div>

            <div class="search-container">
                <input type="text" id="searchInput" placeholder="ğŸ” ê²€ìƒ‰ì–´ ì…ë ¥..." />
                <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">âœ•</button>
            </div>

            <div class="management-buttons">
                <button id="selectAllBtn">ğŸ”² ì „ì²´ì„ íƒ</button>
                <button id="createFolderBtn">ğŸ“ í´ë”</button>
                <button id="uploadBtn">ğŸ“¤ ì—…ë¡œë“œ</button>
                <button id="bulkDeleteBtn" style="background-color: #dc3545; color: white; display: none;">ğŸ—‘ï¸ ì„ íƒ ì‚­ì œ</button>

            </div>

            <div id="rootDropZone" class="root-drop-zone">
                ì—¬ê¸°ì— ë“œë¡­í•˜ë©´ <strong>ìµœìƒìœ„ í´ë”</strong>ë¡œ ì´ë™
            </div>

            <div id="itemList" class="notion-list">ë¡œë”© ì¤‘...</div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ì»¨í…ì¸  -->
        <div class="notion-content-container">
            <div id="itemTitle" class="notion-title">
                íŒŒì¼ì´ë‚˜ ë…¸íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
            </div>

            <div id="buttonContainer" class="button-container"></div>

            <div class="content-area">
                <div id="welcomeMessage" class="welcome-message">
                    <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                    <p>ì™¼ìª½ì—ì„œ íŒŒì¼ì´ë‚˜ ì •ë¦¬ë³¸ì„ ì„ íƒí•˜ì‹œë©´<br>ë‚´ìš©ì„ í™•ì¸í•˜ê³  í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                </div>
                <div id="categorySelectArea" style="display: none; margin: 10px 0; gap:10px;">
                    <label>ğŸ“‚ ì¹´í…Œê³ ë¦¬</label>
                    <select id="largeCategorySelect">
                        <option value="">ëŒ€ë¶„ë¥˜ ì„ íƒ</option>
                    </select>
                    <select id="mediumCategorySelect" disabled>
                        <option value="">ì¤‘ë¶„ë¥˜ ì„ íƒ</option>
                    </select>
                    <select id="smallCategorySelect" disabled>
                        <option value="">ì†Œë¶„ë¥˜ ì„ íƒ</option>
                    </select>
                    <button id="addCategoryBtn">â• ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€</button>
                </div>
                <!-- íƒœê·¸ ì…ë ¥ ì˜ì—­ ì¶”ê°€ -->
                <div id="tagInputArea" style="display: none; margin-top: 15px; gap:10px;">
                    <label style="width:100px;">ğŸ·ï¸ íƒœê·¸</label>
                    <div class="tag-input-wrapper">
                        <div id="tagDisplay" class="tag-display"></div>
                        <input type="text" id="tagInput" placeholder="Enter í‚¤ë¡œ íƒœê·¸ ì¶”ê°€ | í´ë¦­ìœ¼ë¡œ ì œê±°">
                    </div>
                </div>

                <!-- âœ… í…ìŠ¤íŠ¸ í¸ì§‘ê¸° (ê¸°ë³¸) -->
                <textarea id="itemContent" class="notion-content" style="display: none;"></textarea>

                <!-- âœ… Toast UI Editor ì˜ì—­ -->
                <div id="editorArea" style="display: none; height:510px"></div>

                <!-- âœ… ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ (PDF, ì´ë¯¸ì§€) -->
                <div id="previewArea" style="display: none;">
                    <iframe id="pdfPreview" style="display: none; width: 100%; height: 100%; border: none;"></iframe>
                    <img id="imagePreview" style="display: none; width: 100%; height: 100%; object-fit: contain;" alt="ë¯¸ë¦¬ë³´ê¸°">
                    <div id="hwpPreview" class="file-preview hwp-preview" style="display:none;">
                        <div id="hwpContainer" class="hwp-container"></div>
                    </div>
                </div>

                <!-- âœ… ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì˜ì—­ (Excel, CSV) -->
                <div id="spreadsheetArea" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>


<input type="file" id="fileInput" style="display: none;">

<script type="module">
    import * as HWP from '/js/hwp.browser.js';
    window.HWP = HWP;
    window.HWPLoaded = true;
    console.log('âœ… HWP ë¡œë“œ ì™„ë£Œ');
</script>
<div th:replace="~{fragments/footer :: footer}"></div>

<script th:src="@{/js/NotionManager.js}"></script>


</body>
</html>
