<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">강의 추천</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link id="theme-css" rel="stylesheet" th:href="@{/css/recomLecture.css}">
    <script>
document.addEventListener("DOMContentLoaded", () => {
  const themeLink = document.getElementById("theme-css");
  const themeToggleBtn = document.getElementById("theme-toggle-btn");

  // 저장된 모드 불러오기
  const savedTheme = localStorage.getItem("theme") || "light";

  // 로그인 여부 확인 (버튼이 없으면 로그아웃 상태로 판단)
  const isLoggedIn = !!themeToggleBtn;

  if (isLoggedIn) {
    // 로그인 상태에서는 저장된 테마 적용
    applyTheme(savedTheme);

    // 버튼 클릭 시 다크모드 전환
    themeToggleBtn.addEventListener("click", () => {
      const current = localStorage.getItem("theme") || "light";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
    });
  } else {
    // 로그아웃 상태에서는 항상 라이트모드 적용
    applyTheme("light");
  }

  // ✅ 테마 적용 함수
  function applyTheme(mode) {
    if (mode === "dark") {
      themeLink.setAttribute("href", "/CSSDARK/recomLecture.css");
      localStorage.setItem("theme", "dark");
      if (themeToggleBtn) {
        themeToggleBtn.classList.add("dark"); // 버튼 이동 클래스 추가
      }
    } else {
      themeLink.setAttribute("href", "/css/recomLecture.css");
      localStorage.setItem("theme", "light");
      if (themeToggleBtn) {
        themeToggleBtn.classList.remove("dark"); // 기본 위치로 복귀
      }
    }
  }
});
</script>
    
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>
<div th:replace="fragments/header :: siteHeader"></div>

<div class="full-container">
    <div class="full-location-container">

        <!-- 검색창 -->
        <div class="searchBar-container" role="search">
            <input id="rec-search" class="search-bar" type="text"
                   placeholder="검색어를 입력하세요 (예: Docker, MongoDB, 테이블)">
            <button id="rec-search-btn" class="rec-search-btn">검 색</button>
        </div>

        <div class="search-mode-container" style="margin: 10px 0; text-align: center;">
            <label style="margin-right: 15px; cursor: pointer;">
                <input type="radio" name="searchMode" value="OR" checked>
                <span style="margin-left: 5px;">일부 포함 (OR)</span>
            </label>
            <label style="cursor: pointer;">
                <input type="radio" name="searchMode" value="AND">
                <span style="margin-left: 5px;">전부 포함 (AND)</span>
            </label>
        </div>

        <!-- 태그 버블 영역 -->
        <div id="tag-bubble-area" class="tag-bubble-area">
            <span class="bubble-label">검색 태그:</span>
            <div id="tag-bubble-container" class="tag-bubble-container">
                <!-- 동적으로 태그 버블 추가됨 -->
            </div>
            <button id="clear-tags-btn" class="clear-tags-btn" style="display:none;">모두 지우기</button>
        </div>

        <!-- 강의 리스트 컨테이너 -->
        <div class="lecture-list-container">
            <section id="rec-lecture-list" class="rec-section" aria-live="polite">
                <!-- 동적으로 강의 카드 추가됨 -->
            </section>

            <div id="rec-empty" class="rec-empty" style="display:none;">
                추천 강의가 없습니다.
            </div>

            <div id="rec-error" class="rec-error" style="display:none;">
                강의 목록을 불러오는 중 오류가 발생했습니다.
            </div>
        </div>

        <!-- 페이징 버튼 (새로 추가) -->
        <div id="pagination-container" class="pagination-container" style="display:none;">
            <button id="prev-page-btn" class="page-btn" disabled>이전</button>
            <span id="page-info" class="page-info">1 / 1</span>
            <button id="next-page-btn" class="page-btn">다음</button>
        </div>

        <!-- 강의 카드 템플릿 -->
        <template id="rec-lecture-card-tpl">
            <div class="lecture-list">
                <div class="lecture-img rec-textbox">
                    <div class="rec-title"></div>
                    <div class="rec-tags"></div>
                </div>
                
                <div class="rec-row">
                    <button type="button" class="rec-openBtn">강의열기</button>
                    <button type="button" class="rec-openBtn2">바로보기</button>
                </div>
            </div>
        </template>

        <div id="videoModal" class="video-modal">
            <div class="video-modal-content">
                <div class="video-modal-header">
                    <h3 id="videoModalTitle">강의 제목</h3>
                    <!-- ⭐ 수동 볼륨 조절 -->
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label style="color: white;">볼륨 증폭:</label>
                        <input type="range" id="volumeBoost" min="0" max="10" step="0.1" value="1.0"
                               style="width: 150px;"
                               oninput="adjustVolume(this.value)">
                        <span id="volumeLabel" style="color: white;">1.0x</span>
                    </div>
                    <button class="video-modal-close" onclick="closeVideoModal()">
                        닫기 ✕
                    </button>
                </div>
                <div class="video-container">
                    <video id="videoPlayer" controls controlsList="nodownload">
                        <source id="videoSource" src="" type="video/mp4">
                        브라우저가 비디오 재생을 지원하지 않습니다.
                    </video>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/recomLecture.js}"></script>
</body>
</html>
